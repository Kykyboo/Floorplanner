<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>LiteCAD Studio | Pro Architect</title>
    <style>
        :root {
            --bg: #09090b;
            --panel: #18181b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --text: #f4f4f5;
            --text-dim: #a1a1aa;
            --border: #27272a;
        }

        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; height: 100vh; overflow: hidden; }

        /* Setup Screen */
        #setup-screen {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #1e1b4b 0%, #09090b 100%);
            display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        .setup-card {
            background: rgba(24, 24, 27, 0.8); backdrop-filter: blur(20px);
            padding: 40px; border-radius: 24px; border: 1px solid var(--border);
            width: 400px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .setup-card h1 { margin-top: 0; font-size: 24px; font-weight: 800; text-align: center; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 12px; color: var(--text-dim); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .setup-card input {
            width: 100%; background: #000; border: 1px solid var(--border); color: white;
            padding: 12px; border-radius: 8px; outline: none; transition: 0.2s;
        }
        .setup-card input:focus { border-color: var(--accent); }
        .start-btn {
            width: 100%; background: var(--accent); color: white; border: none; padding: 14px;
            border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s;
        }
        .start-btn:hover { background: var(--accent-hover); transform: translateY(-2px); }

        /* Editor UI */
        #editor-ui { display: none; flex-direction: column; height: 100vh; }
        
        header { 
            background: var(--panel); padding: 12px 24px; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 1px solid var(--border);
        }

        .main-layout { display: flex; flex: 1; overflow: hidden; }

        .toolbar { 
            width: 72px; background: var(--panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 12px;
        }
        .t-btn { 
            width: 48px; height: 48px; border-radius: 12px; border: 1px solid transparent;
            background: #27272a; color: var(--text-dim); cursor: pointer; font-size: 20px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .t-btn:hover { background: #3f3f46; color: white; }
        .t-btn.active { background: var(--accent); color: white; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }

        .viewport { flex: 1; background: #000; overflow: auto; display: flex; align-items: center; justify-content: center; padding: 40px; }
        #canvas-shadow { background: white; box-shadow: 0 0 60px rgba(0,0,0,0.5); }
        
        .sidebar { width: 300px; background: var(--panel); border-left: 1px solid var(--border); padding: 24px; overflow-y: auto; }
        .sidebar h3 { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 16px; }

        .inspector-card { background: #27272a; border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 1px solid #3f3f46; }
        .prop-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 13px; }
        
        footer { background: var(--panel); padding: 8px 24px; font-size: 11px; color: var(--text-dim); border-top: 1px solid var(--border); display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div id="setup-screen">
    <div class="setup-card">
        <h1>LITECAD STUDIO</h1>
        <div class="input-group">
            <label>Project Naam</label>
            <input type="text" id="setup-name" value="Nieuw Ontwerp">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="input-group">
                <label>Breedte (px)</label>
                <input type="number" id="setup-w" value="1200">
            </div>
            <div class="input-group">
                <label>Hoogte (px)</label>
                <input type="number" id="setup-h" value="800">
            </div>
        </div>
        <button class="start-btn" onclick="app.startEditor()">START EDITOR</button>
    </div>
</div>

<div id="editor-ui">
    <header>
        <div style="display:flex; align-items:center; gap:16px;">
            <span style="font-weight:900; color:var(--accent); font-size:20px;">LC</span>
            <span id="display-name" style="font-weight:600; opacity:0.8;"></span>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="start-btn" style="padding: 8px 16px; font-size:12px; background:#27272a;" onclick="app.saveJSON()">JSON SAVE</button>
            <button class="start-btn" style="padding: 8px 16px; font-size:12px;" onclick="app.exportBlueprint()">DOWNLOAD PNG</button>
        </div>
    </header>

    <div class="main-layout">
        <div class="toolbar">
            <button class="t-btn active" data-tool="select">üéØ</button>
            <button class="t-btn" data-tool="line">üìè</button>
            <button class="t-btn" data-tool="rect">üì¶</button>
            <button class="t-btn" data-tool="text">T</button>
            <hr style="width:30px; border-color:var(--border);">
            <button class="t-btn" onclick="app.undo()">‚Ü©Ô∏è</button>
            <button class="t-btn" onclick="app.clear()">üóëÔ∏è</button>
        </div>

        <div class="viewport">
            <div id="canvas-shadow">
                <canvas id="mainCanvas"></canvas>
            </div>
        </div>

        <div class="sidebar">
            <div class="inspector-card">
                <h3>Eigenschappen</h3>
                <div id="no-selection" style="font-size:12px; color:var(--text-dim);">Geen selectie</div>
                <div id="props-ui" style="display:none;">
                    <div class="prop-row">Kleur <input type="color" id="pColor" oninput="app.updateObj()"></div>
                    <div class="prop-row">Breedte <input type="range" id="pW" min="10" max="1000" oninput="app.updateObj()"></div>
                    <div class="prop-row">Hoogte <input type="range" id="pH" min="10" max="1000" oninput="app.updateObj()"></div>
                    <div class="prop-row">Tekst <input type="text" id="pText" style="width:100px; background:#000; border:1px solid #444; color:white;" oninput="app.updateObj()"></div>
                    <button class="start-btn" style="background:#ef4444; margin-top:10px;" onclick="app.deleteSelected()">VERWIJDER</button>
                </div>
            </div>

            <div class="inspector-card">
                <h3>Snelmenu</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                    <button class="start-btn" style="background:#3f3f46; font-size:11px;" onclick="app.addFurniture('Bed', 80, 120)">BED</button>
                    <button class="start-btn" style="background:#3f3f46; font-size:11px;" onclick="app.addFurniture('Bank', 140, 60)">BANK</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div>LITECAD V3 | High-DPI Rendering</div>
        <div>Sneltoetsen: CTRL+Z (Undo) | DEL (Verwijder) | Versleep om te verplaatsen</div>
    </footer>
</div>

<script>
class Shape {
    constructor(type, x, y, text = "") {
        this.id = Math.random().toString(36).substr(2, 9);
        this.type = type;
        this.x = x; this.y = y;
        this.w = 0; this.h = 0;
        this.color = "#000000";
        this.text = text;
        this.selected = false;
        this.isDragging = false;
    }

    draw(ctx, isExport = false) {
        ctx.save();
        ctx.lineWidth = this.selected ? 4 : 2;
        ctx.strokeStyle = isExport ? "#FFF" : (this.selected ? "#3b82f6" : this.color);
        ctx.fillStyle = isExport ? "rgba(255,255,255,0.1)" : (this.selected ? "rgba(59, 130, 246, 0.1)" : "rgba(0,0,0,0.02)");

        if (this.type === 'rect') {
            ctx.strokeRect(this.x, this.y, this.w, this.h);
            ctx.fillRect(this.x, this.y, this.w, this.h);
            if(this.text) {
                ctx.fillStyle = isExport ? "#FFF" : this.color;
                ctx.font = `bold ${isExport ? 24 : 12}px sans-serif`;
                ctx.fillText(this.text, this.x + 5, this.y + 15);
            }
        } else if (this.type === 'line') {
            ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.w, this.y + this.h); ctx.stroke();
        } else if (this.type === 'text') {
            ctx.fillStyle = isExport ? "#FFF" : (this.selected ? "#3b82f6" : this.color);
            ctx.font = `bold ${isExport ? 40 : 18}px sans-serif`;
            ctx.fillText(this.text, this.x, this.y);
        }
        ctx.restore();
    }

    isHit(mx, my) {
        const p = 10;
        const xMin = Math.min(this.x, this.x + this.w) - p;
        const xMax = Math.max(this.x, this.x + this.w) + p;
        const yMin = Math.min(this.y, this.y + this.h) - p;
        const yMax = Math.max(this.y, this.y + this.h) + p;
        return mx >= xMin && mx <= xMax && my >= yMin && my <= yMax;
    }
}

const app = {
    shapes: [],
    history: [],
    tool: 'select',
    isDown: false,
    selectedObj: null,
    dragOffset: { x: 0, y: 0 },
    config: { w: 1200, h: 800, name: "" },

    startEditor() {
        this.config.w = parseInt(document.getElementById('setup-w').value);
        this.config.h = parseInt(document.getElementById('setup-h').value);
        this.config.name = document.getElementById('setup-name').value;
        
        document.getElementById('display-name').innerText = this.config.name.toUpperCase();
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('editor-ui').style.display = 'flex';
        
        this.initCanvas();
    },

    initCanvas() {
        this.canvas = document.getElementById('mainCanvas');
        this.ctx = this.canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        this.canvas.width = this.config.w * dpr;
        this.canvas.height = this.config.h * dpr;
        this.canvas.style.width = this.config.w + "px";
        this.canvas.style.height = this.config.h + "px";
        this.ctx.scale(dpr, dpr);
        
        this.bindEvents();
        this.render();
    },

    bindEvents() {
        document.querySelectorAll('.t-btn[data-tool]').forEach(b => {
            b.onclick = () => {
                document.querySelectorAll('.t-btn').forEach(x => x.classList.remove('active'));
                b.classList.add('active');
                this.tool = b.dataset.tool;
            };
        });

        this.canvas.onmousedown = (e) => {
            const m = this.getMouse(e);
            this.isDown = true;
            if (this.tool === 'select') {
                const hit = [...this.shapes].reverse().find(s => s.isHit(m.x, m.y));
                this.shapes.forEach(s => s.selected = false);
                if (hit) {
                    hit.selected = true; this.selectedObj = hit; hit.isDragging = true;
                    this.dragOffset = { x: m.x - hit.x, y: m.y - hit.y };
                    this.showInspector(hit);
                } else { this.selectedObj = null; this.showInspector(null); }
            } else {
                this.save();
                this.activeShape = new Shape(this.tool, m.x, m.y);
                if (this.tool === 'text') {
                    const t = prompt("Tekst:"); this.activeShape.text = t || "Label";
                }
                this.shapes.push(this.activeShape);
            }
        };

        window.onmousemove = (e) => {
            const m = this.getMouse(e);
            if (!this.isDown) return;
            if (this.selectedObj && this.selectedObj.isDragging) {
                this.selectedObj.x = m.x - this.dragOffset.x;
                this.selectedObj.y = m.y - this.dragOffset.y;
            } else if (this.activeShape) {
                this.activeShape.w = m.x - this.activeShape.x;
                this.activeShape.h = m.y - this.activeShape.y;
            }
        };

        window.onmouseup = () => { this.isDown = false; if (this.selectedObj) this.selectedObj.isDragging = false; this.activeShape = null; };
        window.onkeydown = (e) => { if (e.ctrlKey && e.key === 'z') this.undo(); if (e.key === 'Delete') this.deleteSelected(); };
    },

    getMouse(e) {
        const r = this.canvas.getBoundingClientRect();
        return { x: Math.round((e.clientX - r.left)/20)*20, y: Math.round((e.clientY - r.top)/20)*20 };
    },

    showInspector(obj) {
        const ui = document.getElementById('props-ui');
        const empty = document.getElementById('no-selection');
        if (obj) {
            ui.style.display = 'block'; empty.style.display = 'none';
            document.getElementById('pColor').value = obj.color;
            document.getElementById('pW').value = Math.abs(obj.w);
            document.getElementById('pH').value = Math.abs(obj.h);
            document.getElementById('pText').value = obj.text || "";
        } else { ui.style.display = 'none'; empty.style.display = 'block'; }
    },

    updateObj() {
        if (!this.selectedObj) return;
        this.selectedObj.color = document.getElementById('pColor').value;
        this.selectedObj.w = parseInt(document.getElementById('pW').value) * (this.selectedObj.w < 0 ? -1 : 1);
        this.selectedObj.h = parseInt(document.getElementById('pH').value) * (this.selectedObj.h < 0 ? -1 : 1);
        this.selectedObj.text = document.getElementById('pText').value;
    },

    addFurniture(name, w, h) { this.save(); const f = new Shape('rect', 100, 100, name); f.w = w; f.h = h; this.shapes.push(f); },
    save() { this.history.push(JSON.stringify(this.shapes)); },
    undo() { if (this.history.length) this.shapes = JSON.parse(this.history.pop()).map(s => Object.assign(new Shape(), s)); },
    clear() { if(confirm("Legen?")) this.shapes = []; },
    deleteSelected() { this.shapes = this.shapes.filter(s => !s.selected); this.showInspector(null); },

    exportBlueprint() {
        const dpr = 4;
        const ec = document.createElement('canvas');
        ec.width = this.config.w * dpr; ec.height = this.config.h * dpr;
        const ex = ec.getContext('2d');
        ex.fillStyle = "#003366"; ex.fillRect(0, 0, ec.width, ec.height);
        ex.scale(dpr, dpr);
        this.shapes.forEach(s => s.draw(ex, true));
        const a = document.createElement('a');
        a.download = `BLUEPRINT_${this.config.name}.png`;
        a.href = ec.toDataURL();
        a.click();
    },

    render() {
        this.ctx.clearRect(0, 0, this.config.w, this.config.h);
        this.ctx.strokeStyle = "rgba(0,0,0,0.1)"; this.ctx.lineWidth = 0.5;
        for(let x=0; x<this.config.w; x+=20) { this.ctx.beginPath(); this.ctx.moveTo(x,0); this.ctx.lineTo(x,this.config.h); this.ctx.stroke(); }
        for(let y=0; y<this.config.h; y+=20) { this.ctx.beginPath(); this.ctx.moveTo(0,y); this.ctx.lineTo(this.config.w,y); this.ctx.stroke(); }
        this.shapes.forEach(s => s.draw(this.ctx));
        requestAnimationFrame(() => this.render());
    }
};
</script>
</body>
</html>
